<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Study Page</title>
    <style>
        body { font-family: sans-serif; }
        header { border-bottom: 1px solid #ccc; padding: 10px 0; }
        nav ul { list-style: none; padding: 0; margin: 0; display: flex; justify-content: center; }
        nav ul li { margin: 0 20px; }
        nav ul li a { text-decoration: none; color: #333; font-weight: bold; font-size: 18px; }
        nav ul li a:hover { color: #007bff; }
        .container { display: flex; }
        .sidebar { width: 200px; border-right: 1px solid #ccc; padding: 20px; }
        .sidebar ul { list-style: none; padding: 0; }
        .sidebar ul li { margin-bottom: 10px; }
        .sidebar ul li a { text-decoration: none; color: #333; }
        .main-content { flex-grow: 1; padding: 20px; }
        .post-list { list-style: none; padding: 0; }
        .post-list li { border-bottom: 1px solid #eee; padding: 15px 0; }
        .post-list li:last-child { border-bottom: none; }
        .post-list h3 { margin: 0; }
        .post-list h3 a {
            text-decoration: none;
            color: #333;
            font-size: 1.2em;
        }
        .post-list h3 a:hover {
            color: #007bff;
            text-decoration: underline;
        }
        .write-button-container { text-align: right; margin-bottom: 20px; }
        .write-button { padding: 10px 20px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px; }

        .modal {
            display: none; /* 평소에는 숨김 */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5); /* 반투명 검은 배경 */
        }

        /* 모달 내용 박스 */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 400px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* 닫기 버튼(X) */
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-btn:hover { color: black; }

        /* 카테고리 목록 리스트 */
        .modal-category-list {
            list-style: none;
            padding: 0;
        }
        .modal-category-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .modal-category-list li:last-child { border-bottom: none; }

        /* 삭제 버튼 */
        .delete-btn-small {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        /* 사이드바 편집 링크 버튼 */
        .edit-category-btn {
            display: block;
            margin-top: 15px;
            font-size: 0.9em;
            color: #666;
            text-decoration: underline;
            cursor: pointer;
            border: none;
            background: none;
            padding: 0;
        }
    </style>
</head>
<body>

<header>
    <nav>
        <ul>
            <li><a th:href="@{/main}">MAIN</a></li>
            <li><a th:href="@{/hobby}">HOBBY</a></li>
            <li><a th:href="@{/study}">STUDY</a></li>
        </ul>
    </nav>
</header>

<div class="container">
    <aside class="sidebar">
        <h2>Categories</h2>
        <ul>
            <li><a th:href="@{/study}">All</a></li>
            <li th:each="category : ${categories}">
                <a th:href="@{/study(categoryId=${category.id})}" th:text="${category.name}">Category Name</a>
            </li>
        </ul>

        <button onclick="openModal()" class="edit-category-btn">카테고리 편집</button>
    </aside>

    <main class="main-content">
        <div class="write-button-container">
            <a href="/study/write" class="write-button">글쓰기</a>
        </div>
        <h1>Study Posts</h1>
        <ul class="post-list">
            <li th:each="post : ${posts}">
                <h3>
                    <a th:href="@{/study/{id}(id=${post.id})}" th:text="${post.title}">Post Title</a>
                </h3>
            </li>
        </ul>
    </main>
</div>

<div id="categoryModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2>카테고리 관리</h2>
        <p style="font-size: 0.9em; color: #666; margin-bottom: 20px;">게시글이 없는 카테고리만 삭제 가능합니다.</p>

        <ul class="modal-category-list">
            <li th:each="category : ${categories}">
                <span th:text="${category.name}">카테고리 이름</span>

                <form th:action="@{/study/category/{id}/delete(id=${category.id})}" method="post"
                      onsubmit="return confirm('정말 삭제하시겠습니까?');">
                    <button type="submit" class="delete-btn-small">삭제</button>
                </form>
            </li>
        </ul>
    </div>
</div>

<script th:inline="javascript">
    var errorMessage = [[${errorMessage}]];
    if (errorMessage) {
        alert(errorMessage);
    }

    function openModal() {
        document.getElementById('categoryModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('categoryModal').style.display = 'none';
    }

    window.onclick = function(event) {
        const modal = document.getElementById('categoryModal');
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>

</body>
</html>